const express = require("express");
const path = require("path");
const sharp = require("sharp");

const { $, _ } = require("./build/constants.js");
const { findMate } = require("./build/mate_finder.js");

const app = express();

app.set("view engine", "ejs");
app.set("views", path.join(__dirname, "public"));

app.get("/:a/:b/:c/:d/:e/:f/:g/:h", (req, res) => {
  const { a, b, c, d, e, f, g, h } = req.params;
  res.redirect(`/?fen=${[a, b, c, d, e, f, g, h].join("/")}`);
});

app.get("/", (req, res) => {
  const fen = req.query.fen;
  const img = "img" in req.query;
  const flip = "flip" in req.query;
  const og = "og" in req.query;

  if (!fen) return res.render("index");

  const [has_mate, check_squares, attacker, parsed_fen] = findMate(fen);

  if (!img) return res.render("result", { fen: encodeURIComponent(fen), flip, has_mate });

  const { pieces, side } = parsed_fen._metadata;

  const check_squares_id = check_squares.map($);
  const attacker_id = attacker.map($);

  const c = (i) => (flip ^ (side === "w") ? 63 - i : i);
  const dimension = og ? "-181 0 762 400" : "0 0 400 400";

  let svg = `<svg viewBox="${dimension}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style>text{font-family:Arial,sans-serif;fill:#59935d;font-size:12px}.l{fill:#f1f6b2}</style><defs>`;

  if (pieces.includes("b"))
    svg += `<g id="b" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M31.016 32.267L35.7419 26.3238L25.5519 13.3488H24.8511V13.3384H24.1401L13.9501 26.3134L18.676 32.2565L17.1332 37.1235C17.1021 37.5091 20.2283 39.1571 24.8464 39.1571C29.4642 39.1571 32.5915 37.509 32.5599 37.1235L31.016 32.267Z" fill="url(#paint0_linear_6_204)" stroke="black" stroke-linecap="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M24.8261 7.6979C23.2763 7.6979 22.0193 8.9369 22.0193 10.4653C22.0193 11.9937 23.2764 13.2325 24.8261 13.2325C26.3758 13.2325 27.6313 11.9931 27.6313 10.4653C27.6313 8.9372 26.3758 7.6981 24.8261 7.6979V7.6979Z" fill="url(#paint1_linear_6_204)" stroke="black" stroke-width="0.99998" stroke-linecap="round" stroke-linejoin="round" /><path d="M22.0961 24.66H27.5961M24.8461 21.9101V27.4101" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.2" filter="url(#filter0_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.8383 7.7169C28.3638 9.56943 25.3563 12.7559 23.2615 13.0362C23.7385 13.2374 24.2721 13.3537 24.8383 13.3537C30.5507 11.5554 26.2004 7.58567 24.8383 7.71687V7.7169ZM24.1275 13.3555C27.3223 17.5602 30.1705 21.9989 33.143 26.3416L28.1761 31.6541L29.3019 36.1732L32.4029 37.0546L31.0038 32.2839L35.7289 26.3415L25.5401 13.3667H24.8391V13.3558L24.1275 13.3555Z" fill="black" /></g><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M26.073 35.618C22.9858 35.6302 19.6757 36.1221 17.7042 37.3856C19.8856 38.8871 23.5025 39.2122 26.5892 39.1553C19.4495 37.7113 28.6192 36.1897 31.4333 36.1546C29.9109 35.7872 27.7237 35.6114 26.073 35.6181V35.618Z" fill="black" /><path d="M17.134 37.123C17.134 37.123 19.0586 35.5571 24.8479 35.5571C30.6372 35.5571 32.5608 37.123 32.5608 37.123" stroke="black" stroke-width="0.99998" /><path d="M18.676 32.256C18.676 32.256 20.539 31.2346 24.8512 31.2345C29.1634 31.2344 31.0263 32.256 31.0263 32.256" stroke="black" stroke-width="0.99998" /><g opacity="0.3" filter="url(#filter1_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.872 31.579C18.872 31.579 18.8745 31.587 18.872 31.579L14.7012 26.3202L24.4365 13.8892L16.3612 26.2742L18.872 31.579Z" fill="white" /></g><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M25 39.156C19.3831 39.1561 17.7042 37.3856 17.7042 37.3856C17.7042 37.3856 19.3829 35.6153 25 35.6152C30.6169 35.6151 32.2958 37.3856 32.2958 37.3856C32.2958 37.3856 30.6171 39.1559 25 39.156Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M22.6499 39.156C17.4568 45.4145 10.8599 36.2408 4.11694 42.6433L6.08484 46.2961C10.4828 40.6242 24.9998 51.5094 24.9998 39.156H22.6499Z" fill="url(#paint2_linear_6_204)" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M27.3499 39.156C32.543 45.4145 39.1399 36.2408 45.8819 42.6433L43.914 46.2961C39.516 40.6242 24.999 51.5094 24.999 39.156H27.3499Z" fill="url(#paint3_linear_6_204)" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.3" filter="url(#filter2_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.83374 42.735L6.23714 45.325L5.89138 42.9915C9.01148 40.6044 11.849 41.3721 13.9321 41.3931C13.9321 41.3931 8.08008 39.4384 4.83378 42.735H4.83374Z" fill="white" /></g><g opacity="0.2" filter="url(#filter3_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M45.242 42.769L44.7523 43.6576C42.847 41.3331 41.0133 40.9023 39.4335 40.8974C39.4335 40.8974 42.4507 40.1802 45.242 42.7691V42.769Z" fill="white" /></g><g opacity="0.2" filter="url(#filter4_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M23.672 12.366C23.422 12.4323 21.0687 9.9458 24.0896 8.3908C24.0006 8.3817 22.3323 10.5327 23.672 12.366Z" fill="white" /></g><g opacity="0.1" filter="url(#filter5_f_6_204)"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.1427 35.9463L19.1942 32.673C19.1942 32.673 19.5632 32.4197 20.6487 32.244C20.6487 32.244 19.9026 34.444 21.1566 35.2535C19.0014 35.586 18.619 35.8015 18.1427 35.9462V35.9463Z" fill="white" /></g><defs><filter id="filter0_f_6_204" x="22.4253" y="6.87753" width="14.1397" height="31.0132" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.418085" result="effect1_foregroundBlur_6_204" /></filter><filter id="filter1_f_6_204" x="13.467" y="12.6551" width="12.2036" height="20.1616" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.617068" result="effect1_foregroundBlur_6_204" /></filter><filter id="filter2_f_6_204" x="4.0004" y="39.9844" width="10.7651" height="6.1739" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.41667" result="effect1_foregroundBlur_6_204" /></filter><filter id="filter3_f_6_204" x="38.7407" y="40.1134" width="7.19405" height="4.23692" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.346394" result="effect1_foregroundBlur_6_204" /></filter><filter id="filter4_f_6_204" x="22.3159" y="8.14315" width="2.02136" height="4.47177" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.12381" result="effect1_foregroundBlur_6_204" /></filter><filter id="filter5_f_6_204" x="17.6054" y="31.7067" width="4.08851" height="4.77688" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.268649" result="effect1_foregroundBlur_6_204" /></filter><linearGradient id="paint0_linear_6_204" x1="13.3742" y1="26.2472" x2="36.316" y2="26.2472" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_204" x1="21.5713" y1="10.4656" x2="28.0773" y2="10.4656" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint2_linear_6_204" x1="3.53719" y1="42.725" x2="25.583" y2="42.725" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint3_linear_6_204" x1="24.4203" y1="42.725" x2="46.4656" y2="42.725" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient></defs></g>  `;
  if (pieces.includes("k"))
    svg += `<g id="k" fill="none"><g clip-path="url(#clip0_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1321 18.792C35.5189 13.0511 46.6761 16.1857 45.9831 25.6045C45.3042 31.7749 38.9699 33.9519 38.9699 33.9519C38.9699 33.9519 35.1429 31.7241 25.0299 31.724L25.0161 27.7311L29.1321 18.792Z" fill="url(#paint0_linear_6_220)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M37.942 38.831L39.2464 44.1068C39.2464 44.1068 35.4676 46.3347 24.9994 46.3349C14.5314 46.3347 10.7524 44.1068 10.7524 44.1068L12.0563 38.831L11.0598 33.9525C11.0598 33.9525 14.705 31.7245 25.0008 31.7244C35.2958 31.7243 38.9398 33.9525 38.9398 33.9525L37.942 38.831Z" fill="url(#paint1_linear_6_220)" stroke="black" /><path d="M10.754 44.106C10.754 44.106 14.533 41.8778 25.002 41.8778C35.471 41.8777 39.25 44.106 39.25 44.106" stroke="black" /><path d="M12.058 38.831C12.058 38.831 15.4517 36.6029 25.036 36.6028C34.6197 36.6027 38.013 38.831 38.013 38.831" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M20.9 18.792C14.5132 13.0511 3.35601 16.1857 4.04901 25.6045C4.72784 31.775 11.0622 33.9519 11.0622 33.9519C11.0622 33.9519 14.8892 31.7241 25.0022 31.724L25.016 27.7311L20.9 18.792Z" fill="url(#paint2_linear_6_220)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M21.65 9.9111H28.3827ZM25.0162 6.3286V14.3097Z" fill="#59917A" /><path d="M21.65 9.9111H28.3827M25.0162 6.3286V14.3097" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.2" filter="url(#filter0_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M36.557 15.926C35.9954 15.93 35.4113 15.9772 34.8057 16.0716C43.9959 15.8479 48.4006 28.0392 36.2153 32.5698L34.929 37.5321L36.472 43.0186L39.4668 44.1241L37.9607 38.6513L38.9585 33.4402C38.9585 33.4402 45.3022 31.657 45.9709 25.6129C46.4829 20.9855 43.3951 15.8785 36.557 15.9261V15.926Z" fill="black" /></g><path fill-rule="evenodd" clip-rule="evenodd" d="M20.9 18.792L25.0296 27.4454L29.1592 18.792C29.1592 18.792 29.8624 14.0245 25.0296 14.0245C20.1968 14.0245 20.9 18.792 20.9 18.792Z" fill="url(#paint3_linear_6_220)" stroke="black" stroke-linejoin="round" /><g opacity="0.2" filter="url(#filter1_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0281 14.2546C29.8392 15.2254 25.9052 24.7831 25.0442 27.4512C25.0684 27.4763 28.1574 22.0432 29.1099 18.5312C29.2 14.023 25.1988 14.1351 25.0281 14.2544V14.2546Z" fill="black" /></g><g opacity="0.2" filter="url(#filter2_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0179 31.2082L25.017 31.1328C25.0179 31.2082 25.0328 27.7348 25.0328 27.7348C25.0328 27.7348 22.3216 20.8337 20.9354 18.8136C19.5868 16.8483 17.1145 15.8818 14.2964 16.0271C18.3135 17.7936 23.3346 26.0641 25.0182 31.2082H25.0179Z" fill="black" /></g><g opacity="0.3" filter="url(#filter3_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.31433 29.527C5.11813 27.8797 4.30313 25.6769 4.86863 22.8915C6.30513 15.817 14.3256 16.5952 14.3256 16.5952C2.73063 20.0631 6.45373 29.5572 6.31433 29.5272V29.527Z" fill="white" /></g><g opacity="0.2" filter="url(#filter4_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M27.026 24.959L29.7781 19.0303C29.7781 19.0303 32.2247 16.8067 35.8945 16.4588C31.947 17.4909 29.5644 21.3335 27.026 24.9591V24.959Z" fill="white" /></g><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M25.318 41.924C15.007 41.9241 10.754 44.1067 10.754 44.1067C10.754 44.1067 15.0069 46.2892 25.318 46.2892H25.3393C9.89827 44.2992 32.6541 42.4862 33.6235 42.4785C31.4502 42.1621 28.7064 41.9247 25.3183 41.9248L25.318 41.924Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M25 46.296C15.759 46.2961 11.256 44.0872 11.256 44.0872C11.256 44.0872 15.759 41.8785 25 41.8784C34.241 41.8783 38.744 44.0872 38.744 44.0872C38.744 44.0872 34.241 46.2959 25 46.296V46.296Z" fill="black" /><g opacity="0.1" filter="url(#filter5_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.528 39.169C13.3781 38.7193 14.2568 38.5261 15.1214 38.2071C14.5335 39.0481 14.487 40.931 14.7641 42.2694C14.7641 42.2694 13.8721 42.3936 11.5323 43.1737L12.528 39.169Z" fill="white" /></g><g opacity="0.15" filter="url(#filter6_f_6_220)"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.464 38.021C12.464 38.021 12.7646 37.7332 14.8802 37.1442C13.2892 35.543 13.48 33.698 13.3055 33.6282C12.739 33.7961 12.1937 34.0171 11.6555 34.2556L12.464 38.021Z" fill="white" /></g></g><defs><filter id="filter0_f_6_220" x="34.0173" y="15.1374" width="12.7966" height="29.7751" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.394181" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter1_f_6_220" x="24.6817" y="13.8702" width="4.77609" height="13.9275" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.17318" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter2_f_6_220" x="13.7778" y="15.4942" width="11.7737" height="16.2327" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.259317" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter3_f_6_220" x="3.66828" y="15.553" width="11.6743" height="14.9912" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.508451" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter4_f_6_220" x="26.2444" y="15.6772" width="10.4317" height="10.0635" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.390798" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter5_f_6_220" x="10.8479" y="37.5226" width="4.95789" height="6.33549" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.342225" result="effect1_foregroundBlur_6_220" /></filter><filter id="filter6_f_6_220" x="11.0461" y="33.0188" width="4.44354" height="5.61163" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.304701" result="effect1_foregroundBlur_6_220" /></filter><linearGradient id="paint0_linear_6_220" x1="24.5326" y1="24.9632" x2="46.5284" y2="24.9632" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_220" x1="10.1923" y1="39.0345" x2="39.8336" y2="39.0345" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint2_linear_6_220" x1="3.52785" y1="24.9632" x2="25.5337" y2="24.9632" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint3_linear_6_220" x1="20.3761" y1="20.7398" x2="29.7104" y2="20.7398" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><clipPath id="clip0_6_220"><rect width="50" height="50" fill="white" /></clipPath></defs></g>  `;
  if (pieces.includes("n"))
    svg += `<g id="n" fill="none"><g clip-path="url(#clip0_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.393 35.883C13.2799 38.29 14.5504 35.1814 15.5712 32.8299C16.9688 28.8774 22.6988 31.0041 24.3039 26.0349C27.1346 37.1199 14.4394 34.4284 15.0401 46.2959H43.4261C45.3388 24.1929 38.4241 8.8749 17.4691 11.0079C15.3856 8.8317 12.4769 7.4498 12.4769 7.4498C11.3475 9.5346 11.4646 12.1663 13.1437 13.1718C13.5828 13.5727 9.61674 15.2502 10.1483 21.0635C10.1483 21.0635 6.95584 26.3808 5.09334 29.8753C3.73684 32.6069 6.16744 36.1398 9.62894 36.4643" fill="url(#paint0_linear_6_238)" /><path d="M10.393 35.883C13.2799 38.29 14.5504 35.1814 15.5712 32.8299C16.9688 28.8774 22.6988 31.0041 24.3039 26.0349C27.1346 37.1199 14.4394 34.4284 15.0401 46.2959H43.4261C45.3388 24.1929 38.4241 8.8749 17.4691 11.0079C15.3856 8.8317 12.4769 7.4498 12.4769 7.4498C11.3475 9.5346 11.4646 12.1663 13.1437 13.1718C13.5828 13.5727 9.61674 15.2502 10.1483 21.0635C10.1483 21.0635 6.95584 26.3808 5.09334 29.8753C3.73684 32.6069 6.16744 36.1398 9.62894 36.4643" stroke="black" stroke-linecap="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M16.859 17.328C16.8413 17.329 16.8237 17.331 16.8061 17.334C13.8635 17.8126 13.4541 20.592 13.4541 20.592C13.3942 20.8881 13.5858 21.1768 13.8828 21.2377C14.1807 21.2985 14.4717 21.1073 14.5328 20.8105C14.5328 20.8105 14.705 18.7874 16.9843 18.4167C17.2843 18.3677 17.4876 18.0856 17.4384 17.7866C17.3924 17.508 17.1417 17.3096 16.859 17.3282L16.859 17.328Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M16.6999 19.572C16.73 19.7159 16.7294 19.8654 16.6983 20.0119C16.6672 20.1585 16.6061 20.2992 16.5185 20.4261C16.4309 20.5529 16.3186 20.6635 16.1879 20.7514C16.0572 20.8393 15.9107 20.9028 15.7568 20.9384C15.6029 20.974 15.4446 20.9808 15.2909 20.9586C15.1372 20.9364 14.9911 20.8855 14.8611 20.8089C14.731 20.7323 14.6194 20.6315 14.5328 20.5121C14.4461 20.3928 14.386 20.2573 14.356 20.1134C14.3259 19.9696 14.3265 19.8201 14.3576 19.6735C14.3888 19.527 14.4499 19.3863 14.5375 19.2594C14.625 19.1325 14.7374 19.0219 14.8681 18.934C14.9988 18.8461 15.1452 18.7826 15.2991 18.747C15.4531 18.7115 15.6114 18.7046 15.7651 18.7268C15.9187 18.7491 16.0648 18.7999 16.1949 18.8765C16.325 18.9531 16.4365 19.054 16.5232 19.1733C16.6098 19.2926 16.6699 19.4281 16.6999 19.572V19.572Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M8.41882 29.95C8.27485 29.951 8.1371 30.0088 8.03511 30.11C7.59664 30.5462 7.36609 30.9593 7.25596 31.2824C7.14583 31.6054 7.16196 31.8988 7.16196 31.8988C7.19006 32.1996 7.45704 32.4211 7.75905 32.3943C8.06256 32.3672 8.47388 32.1464 8.44581 31.8441C8.44581 31.8441 8.43211 31.8431 8.48691 31.6822C8.54171 31.5215 8.66993 31.2613 8.99982 30.9331C9.2152 30.7188 9.02762 30.3243 8.81226 30.11C8.70788 30.0064 8.56613 29.9487 8.41877 29.9501L8.41882 29.95Z" fill="black" /><g opacity="0.2" filter="url(#filter0_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.3059 11.9585C39.4041 12.6006 41.6029 26.8904 39.9 46.2957H43.4259C45.1793 26.0348 39.5124 11.4764 22.416 10.8339L22.3059 11.9585Z" fill="black" /></g><path fill-rule="evenodd" clip-rule="evenodd" d="M17.454 12.38C17.454 12.38 18.1063 8.2372 21.3544 7.5321C21.3544 7.5321 23.4332 8.6168 23.0179 13.501" fill="url(#paint1_linear_6_238)" /><path d="M17.454 12.38C17.454 12.38 18.1063 8.2372 21.3544 7.5321C21.3544 7.5321 23.4332 8.6168 23.0179 13.501" stroke="black" stroke-linecap="round" /><path d="M12.206 33.765C11.8995 34.2912 10.7541 35.5116 9.63049 36.4662" stroke="black" stroke-linecap="round" /><g opacity="0.3" filter="url(#filter1_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.42737 30.42L9.62157 23.096L10.7936 21.2041C10.7936 21.2041 9.99659 16.7896 13.5127 13.8233C13.5122 13.8243 14.0674 13.2091 13.5157 12.7173C12.9632 12.2252 11.5797 10.5886 12.763 8.3812C12.686 8.35919 13.0371 13.187 17.1163 13.2451C13.1972 14.4944 11.0053 18.2343 11.9653 21.8273C11.2297 23 10.5077 23.9071 9.59097 25.0352C8.77078 26.0445 7.79467 27.2306 6.51337 28.9421C6.17384 29.3957 5.81287 29.8861 5.42767 30.4199L5.42737 30.42Z" fill="white" /></g><g opacity="0.2" filter="url(#filter2_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.757 45.676C15.0133 36.2414 25.841 36.8812 25.1953 28.066C26.2988 39.037 17.3118 37.1951 15.757 45.676Z" fill="white" /></g><g opacity="0.2" filter="url(#filter3_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.75669 30.4951C6.74189 31.0654 8.34358 28.6155 9.81721 30.058C9.21913 28.6341 7.59925 28.1638 6.75669 30.4951Z" fill="white" /></g><g opacity="0.2" filter="url(#filter4_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.027 12.578C18.027 12.578 18.6071 8.8785 21.2757 8.1187C19.7222 10.09 19.5307 13.2725 18.027 12.578Z" fill="white" /></g><g opacity="0.2" filter="url(#filter5_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.6958 25.1264C25.1003 23.9466 25.0214 22.0868 24.665 21.5284C21.7066 30.1656 16.4207 26.9988 15.5645 32.8307C17.2038 29.1378 23.3771 30.4204 24.6958 25.1268V25.1264Z" fill="black" /></g><g opacity="0.2" filter="url(#filter6_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.8562 17.3272C13.6395 17.9403 13.4513 20.5912 13.4513 20.5912C13.4513 20.5912 12.9526 20.8012 12.9608 20.2645C12.7302 19.5792 14.1759 16.8035 16.8562 17.3272V17.3272Z" fill="white" /></g><g opacity="0.1" filter="url(#filter7_f_6_238)"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.0623 21.7525C17.065 20.9907 16.2622 27.133 16.2622 27.133C17.1112 25.2301 19.5475 22.7252 22.0623 21.7525Z" fill="white" /></g><path d="M24.304 26.035C24.304 26.035 24.7026 25.1261 25.0477 22.5481" stroke="black" stroke-linecap="round" stroke-linejoin="round" /></g><defs><filter id="filter0_f_6_238" x="21.1682" y="9.69619" width="23.6999" height="37.7372" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.568857" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter1_f_6_238" x="4.37337" y="7.32713" width="13.7968" height="24.1469" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.526997" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter2_f_6_238" x="14.4973" y="26.843" width="12.0147" height="20.0561" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.611517" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter3_f_6_238" x="6.15969" y="28.2714" width="4.25448" height="2.9084" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.298452" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter4_f_6_238" x="17.4026" y="7.49427" width="4.49751" height="5.80548" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.312213" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter5_f_6_238" x="14.6327" y="20.5967" width="11.2662" height="13.1657" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.465863" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter6_f_6_238" x="12.3538" y="16.6788" width="5.08556" height="4.53601" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.291562" result="effect1_foregroundBlur_6_238" /></filter><filter id="filter7_f_6_238" x="14.5612" y="19.9861" width="9.20212" height="8.84789" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.850486" result="effect1_foregroundBlur_6_238" /></filter><linearGradient id="paint0_linear_6_238" x1="4.22684" y1="26.7998" x2="44.2248" y2="26.7998" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_238" x1="2.33454" y1="9.76174" x2="45.5437" y2="9.76174" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><clipPath id="clip0_6_238"><rect width="50" height="50" fill="white" /></clipPath></defs></g>  `;
  if (pieces.includes("p"))
    svg += `<g id="p" fill="none"><path d="M25 24.9601C28.9549 24.9601 32.1609 21.9004 32.1609 18.126C32.1609 14.3516 28.9549 11.2919 25 11.2919C21.0452 11.2919 17.8391 14.3516 17.8391 18.126C17.8391 21.9004 21.0452 24.9601 25 24.9601Z" fill="url(#paint0_linear_6_255)" stroke="black" stroke-linejoin="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M24.9999 24.598C19.7718 24.6425 17.015 24.5703 16.6058 29.1059H33.3938C32.9846 24.5703 30.2284 24.6425 25.0002 24.598H24.9999Z" fill="url(#paint1_linear_6_255)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M20.484 29.106C20.9797 35.8935 11.1807 37.1018 11.7781 46.296H38.2221C38.8194 37.1015 29.0204 35.893 29.5161 29.106H25.0003H20.484Z" fill="url(#paint2_linear_6_255)" stroke="black" /><g opacity="0.25" filter="url(#filter0_f_6_255)"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.8839 21.629C19.3561 21.8544 15.2989 14.0007 24.7514 11.8566C25.4684 11.7382 26.0027 12.4977 24.7593 12.8961C24.7593 12.8961 17.0197 16.2429 19.8838 21.629H19.8839Z" fill="white" /></g><g opacity="0.2" filter="url(#filter1_f_6_255)"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.504 45.701C12.1798 44.4614 12.3004 41.7278 16.0167 37.6929C15.647 40.1301 12.9524 43.086 15.1165 45.7171L12.504 45.701Z" fill="white" /></g><g opacity="0.2" filter="url(#filter2_f_6_255)"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.282 28.557C17.282 28.557 17.2564 25.6518 20.3881 25.4153C19.3095 26.6268 18.9258 27.321 19.4552 28.5892L17.282 28.557Z" fill="white" /></g><g opacity="0.15" filter="url(#filter3_f_6_255)"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.9813 29.1111C22.2046 34.9807 40.3579 38.1665 38.2185 46.3016C39.4805 38.6426 29.114 36.493 29.5125 29.1111H21.9813Z" fill="black" /></g><g opacity="0.2" filter="url(#filter4_f_6_255)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0087 11.2899C29.8888 11.934 31.4784 21.4989 26.8922 24.3698C26.8922 24.3698 30.2355 24.8673 30.7831 26.9832C30.9492 27.6252 31.2422 29.1035 31.2422 29.1035L33.4023 29.1042C33.4023 29.1042 33.2097 27.6065 32.9422 26.9993C32.0704 25.0211 28.3459 24.3055 28.3459 24.3055C30.1812 23.1592 32.1696 20.1709 32.1696 18.1242C32.5504 13.6997 26.766 10.7865 25.0088 11.29L25.0087 11.2899Z" fill="black" /></g><defs><filter id="filter0_f_6_255" x="17.2307" y="10.5062" width="9.61129" height="12.4655" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.668996" result="effect1_foregroundBlur_6_255" /></filter><filter id="filter1_f_6_255" x="11.4006" y="36.7057" width="5.60337" height="9.99866" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.493617" result="effect1_foregroundBlur_6_255" /></filter><filter id="filter2_f_6_255" x="16.497" y="24.6303" width="4.67608" height="4.7439" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.3925" result="effect1_foregroundBlur_6_255" /></filter><filter id="filter3_f_6_255" x="21.3093" y="28.4391" width="17.7565" height="18.5346" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.336027" result="effect1_foregroundBlur_6_255" /></filter><filter id="filter4_f_6_255" x="24.4834" y="10.7083" width="9.44425" height="18.9212" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.262642" result="effect1_foregroundBlur_6_255" /></filter><linearGradient id="paint0_linear_6_255" x1="17.3399" y1="18.1265" x2="32.6484" y2="18.1265" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_255" x1="16.0642" y1="26.8523" x2="33.924" y2="26.8523" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint2_linear_6_255" x1="11.2558" y1="37.7018" x2="38.7325" y2="37.7018" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient></defs></g>  `;
  if (pieces.includes("q"))
    svg += `<g id="q" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M37.159 38.874L40.3298 34.0652L44.568 14.2392L34.9149 29.0372L35.0589 11.5982L28.156 28.0112L24.989 10.0822L21.8219 28.0092L14.9196 11.5962L15.0637 29.0352L5.4104 14.2372L9.6489 34.0632L13.0086 38.872L11.5999 44.2571C11.5999 44.2571 15.996 46.2959 24.9999 46.296C34.0039 46.2961 38.3889 44.2581 38.3889 44.2581L37.159 38.874Z" fill="url(#paint0_linear_6_264)" stroke="black" stroke-width="1.0011" stroke-linecap="round" /><path d="M9.74707 34.064C11.0943 34.2442 11.3918 33.7095 11.8028 32.1576C11.8028 32.1576 14.2908 33.5013 15.5654 33.2198C16.9296 32.9185 18.0389 31.0481 18.0389 31.0481C18.0389 31.0481 20.1519 32.6068 21.4197 32.502C22.8939 32.3802 24.9228 30.5215 24.9228 30.5215C24.9228 30.5215 26.9517 32.3802 28.4259 32.502C29.6938 32.6068 31.8069 31.0481 31.8069 31.0481C31.8069 31.0481 32.9162 32.9185 34.2805 33.2198C35.5552 33.5013 38.043 32.1576 38.043 32.1576C38.454 33.7095 38.8825 34.2458 40.2298 34.0655" stroke="black" stroke-width="1.0011" stroke-linecap="round" /><path d="M5.41005 17.0371C7.00852 17.0371 8.30435 15.7839 8.30435 14.238C8.30435 12.6921 7.00852 11.4389 5.41005 11.4389C3.81157 11.4389 2.51575 12.6921 2.51575 14.238C2.51575 15.7839 3.81157 17.0371 5.41005 17.0371Z" fill="url(#paint1_linear_6_264)" stroke="black" stroke-width="1.0011" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.2" filter="url(#filter0_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M44.0123 15.722C42.8213 20.3414 39.3118 28.9491 37.9644 33.5338L34.2268 38.2441L35.3067 43.1216L38.3852 44.2559L37.159 38.8699L40.12 34.2979L44.0123 15.722Z" fill="black" /></g><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M24.4961 41.69C19.6607 41.69 14.8252 42.5465 11.6021 44.2595C14.8286 45.974 19.6701 46.0065 24.5101 46.0048C12.5931 44.1277 26.4715 42.3125 31.2494 42.2786C29.1149 41.8876 26.8068 41.69 24.4967 41.69L24.4961 41.69Z" fill="black" /><path d="M11.601 44.26C11.601 44.26 15.9885 42.1237 24.993 42.1236C33.997 42.1235 38.385 44.26 38.385 44.26" stroke="black" stroke-width="1.0011" /><path d="M12.8571 38.874C12.8571 38.874 16.5228 36.8335 25.0081 36.8334C33.4931 36.8333 37.1591 38.874 37.1591 38.874" stroke="black" stroke-width="1.0011" /><path d="M14.9201 13.8791C16.5185 13.8791 17.8144 12.6259 17.8144 11.08C17.8144 9.5341 16.5185 8.2809 14.9201 8.2809C13.3216 8.2809 12.0258 9.5341 12.0258 11.08C12.0258 12.6259 13.3216 13.8791 14.9201 13.8791Z" fill="url(#paint2_linear_6_264)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M24.989 12.8811C26.5875 12.8811 27.8833 11.6279 27.8833 10.082C27.8833 8.53611 26.5875 7.28291 24.989 7.28291C23.3905 7.28291 22.0947 8.53611 22.0947 10.082C22.0947 11.6279 23.3905 12.8811 24.989 12.8811Z" fill="url(#paint3_linear_6_264)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M35.0591 13.8811C36.6576 13.8811 37.9534 12.6279 37.9534 11.082C37.9534 9.53611 36.6576 8.28291 35.0591 8.28291C33.4606 8.28291 32.1648 9.53611 32.1648 11.082C32.1648 12.6279 33.4606 13.8811 35.0591 13.8811Z" fill="url(#paint4_linear_6_264)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M44.568 17.0381C46.1665 17.0381 47.4623 15.7849 47.4623 14.239C47.4623 12.6931 46.1665 11.4399 44.568 11.4399C42.9695 11.4399 41.6737 12.6931 41.6737 14.239C41.6737 15.7849 42.9695 17.0381 44.568 17.0381Z" fill="url(#paint5_linear_6_264)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.3" filter="url(#filter1_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.38599 16.873L10.1191 33.514C10.1191 33.514 10.913 33.5706 11.3924 31.2195L6.38599 16.873Z" fill="white" /></g><g opacity="0.25" filter="url(#filter2_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.522 14.499L17.8629 29.668C17.2368 30.7555 16.3907 31.6681 15.6994 31.838L15.522 14.499Z" fill="white" /></g><g opacity="0.2" filter="url(#filter3_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.986 31.027L25.013 13.415L24.8741 29.172C23.8077 30.0855 22.7249 31.0301 21.986 31.0266L21.986 31.027Z" fill="white" /></g><g opacity="0.15" filter="url(#filter4_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.459 14.605L27.6787 30.787C27.6948 30.6952 28.1458 32.181 31.5094 29.5431L34.459 14.605Z" fill="white" /></g><g opacity="0.1" filter="url(#filter5_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M33.921 31.807L43.14 17.481L37.5416 30.827C37.5416 30.827 34.3887 32.5613 33.921 31.8069V31.807Z" fill="white" /></g><g opacity="0.25" filter="url(#filter6_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.18435 16.16C4.18435 16.16 1.16685 13.4685 5.11851 11.9894C5.20637 12.0034 3.28551 14.1454 4.18435 16.16Z" fill="white" /></g><g opacity="0.2" filter="url(#filter7_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.831 13.031C13.831 13.031 10.8135 10.3395 14.7651 8.8604C14.8545 8.86042 12.969 10.9146 13.831 13.031Z" fill="white" /></g><g opacity="0.2" filter="url(#filter8_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M23.849 12.006C23.849 12.006 20.8315 9.3145 24.7832 7.8354C24.8416 7.83625 22.8559 9.926 23.849 12.006Z" fill="white" /></g><g opacity="0.15" filter="url(#filter9_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M33.935 12.992C33.935 12.992 30.9175 10.3005 34.8691 8.8214C34.9133 8.81847 32.9503 10.9145 33.935 12.992Z" fill="white" /></g><g opacity="0.1" filter="url(#filter10_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M43.4309 16.15C43.4309 16.15 40.4134 13.4585 44.3651 11.9794C44.4113 11.9975 42.4826 14.1697 43.4309 16.15Z" fill="white" /></g><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M24.993 46.396C15.989 46.3961 11.601 44.2596 11.601 44.2596C11.601 44.2596 15.9885 42.1233 24.993 42.1232C33.997 42.1231 38.385 44.2596 38.385 44.2596C38.385 44.2596 33.9975 46.3959 24.993 46.396Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M6.77136 12.412C6.85186 12.4382 9.08556 14.1627 6.62357 16.2759C6.54966 16.1517 7.78577 14.2748 6.77136 12.412V12.412Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M16.3361 9.2456C16.4166 9.27183 18.6503 10.9963 16.1883 13.1095C16.1144 12.9853 17.3505 11.1084 16.3361 9.2456Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M26.4251 8.2762C26.5056 8.30244 28.7393 10.0269 26.2773 12.1401C26.2033 12.0159 27.4395 10.139 26.4251 8.2762Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M36.515 9.2684C36.5955 9.29464 38.8292 11.0191 36.3672 13.1323C36.2933 13.0082 37.5294 11.1312 36.515 9.2684Z" fill="black" /><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M46.059 12.565C46.1395 12.5912 48.3732 14.3157 45.9112 16.4289C45.8373 16.3048 47.0734 14.4278 46.059 12.565V12.565Z" fill="black" /><g opacity="0.1" filter="url(#filter11_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.514 39.223C14.3623 38.7733 15.2139 38.5634 16.085 38.3446C15.4984 39.1856 15.4687 40.985 15.7452 42.3234C15.7452 42.3234 14.8552 42.4476 12.5206 43.2277L13.514 39.223Z" fill="white" /></g><g opacity="0.15" filter="url(#filter12_f_6_264)"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.146 38.084C13.2559 38.068 13.4761 37.7947 15.7375 37.1326C13.7229 35.5476 12.1866 33.0579 12.1866 33.0579C11.8584 33.9725 11.4138 34.5721 10.7717 34.6375L13.146 38.084Z" fill="white" /></g><defs><filter id="filter0_f_6_264" x="33.4604" y="14.9556" width="11.3183" height="30.0667" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.383194" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter1_f_6_264" x="5.95304" y="16.4401" width="5.87225" height="17.507" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.216475" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter2_f_6_264" x="15.1284" y="14.1054" width="3.12814" height="18.1262" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.196799" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter3_f_6_264" x="21.5732" y="13.0022" width="3.85254" height="18.4376" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.20639" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter4_f_6_264" x="27.2128" y="14.1391" width="7.71216" height="17.4488" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.232972" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter5_f_6_264" x="33.4463" y="17.0063" width="10.1684" height="15.4654" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.23735" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter6_f_6_264" x="2.80296" y="11.71" width="2.59793" height="4.72947" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.139717" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter7_f_6_264" x="12.4496" y="8.58096" width="2.59807" height="4.72948" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.139721" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter8_f_6_264" x="22.4677" y="7.55604" width="2.59607" height="4.72932" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.139679" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter9_f_6_264" x="32.5537" y="8.54206" width="2.59554" height="4.72927" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.139668" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter10_f_6_264" x="42.0496" y="11.7001" width="2.59566" height="4.72928" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.139669" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter11_f_6_264" x="11.8448" y="37.6688" width="4.91593" height="6.23469" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.337899" result="effect1_foregroundBlur_6_264" /></filter><filter id="filter12_f_6_264" x="9.97238" y="32.2586" width="6.56452" height="6.62477" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.399675" result="effect1_foregroundBlur_6_264" /></filter><linearGradient id="paint0_linear_6_264" x1="5.44096" y1="28.391" x2="44.5373" y2="28.391" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_264" x1="2.0193" y1="14.2362" x2="8.79948" y2="14.2362" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint2_linear_6_264" x1="11.5293" y1="11.0787" x2="18.3095" y2="11.0787" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint3_linear_6_264" x1="21.5986" y1="10.0816" x2="28.3793" y2="10.0816" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint4_linear_6_264" x1="31.6688" y1="11.0787" x2="38.4495" y2="11.0787" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint5_linear_6_264" x1="41.1778" y1="14.2362" x2="47.959" y2="14.2362" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient></defs></g>  `;
  if (pieces.includes("r"))
    svg += `<g id="r" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.9729 41.57H37.0939ZM12.9669 37.199H37.0329ZM16.9719 33.1474H33.0299ZM17.0619 21.5294H32.9409ZM11.9029 17.0968H38.0989ZM11.9029 9.2861V17.0971L17.0612 21.5297L16.9717 33.1477L12.9678 37.1992V41.5703H9.50537V46.2959H40.4954V41.5703H37.033V37.1992L33.029 33.1477L32.9396 21.5297L38.0979 17.0971V9.2861H32.505V12.6343H27.8917V9.2861H22.1091V12.6343H17.4958V9.2861H11.9029Z" fill="url(#paint0_linear_6_294)" /><path d="M12.9729 41.57H37.0939M12.9669 37.199H37.0329M16.9719 33.1474H33.0299M17.0619 21.5294H32.9409M11.9029 17.0968H38.0989M11.9029 9.2861V17.0971L17.0612 21.5297L16.9717 33.1477L12.9678 37.1992V41.5703H9.50537V46.2959H40.4954V41.5703H37.033V37.1992L33.029 33.1477L32.9396 21.5297L38.0979 17.0971V9.2861H32.505V12.6343H27.8917V9.2861H22.1091V12.6343H17.4958V9.2861H11.9029Z" stroke="black" stroke-linecap="round" /><g opacity="0.2" filter="url(#filter0_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.3992 9.28414V17.0955L30.2236 21.5304L30.3151 33.1481L34.8655 37.1996L34.866 37.2002L34.8655 41.571H37.7814V46.2965H40.4954V41.571H37.0329L37.0334 37.2002L37.0328 37.1996L33.029 33.1481L32.9376 21.5274L38.0956 17.0952V9.28384L35.3992 9.28414Z" fill="black" /></g><g opacity="0.25" filter="url(#filter1_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.4659 16.525L12.4247 9.8501L15.7527 9.75536L13.7558 10.4663V15.8222L18.4603 16.4886L12.4659 16.525Z" fill="white" /></g><g opacity="0.25" filter="url(#filter2_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.596 22.031H25.1765L18.709 23.0305V31.6289L17.5475 32.5514L17.596 22.031Z" fill="white" /></g><g opacity="0.15" filter="url(#filter3_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.358 36.582L17.2177 33.7523H18.6967L16.2961 36.582H14.358Z" fill="white" /></g><g opacity="0.1" filter="url(#filter4_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5179 37.794L13.5226 41.0084H15.0468L15.0436 37.7832L13.5179 37.794Z" fill="white" /></g><g opacity="0.15" filter="url(#filter5_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.067 42.104H11.0816V44.7631L14.9539 45.751H10.067V42.104Z" fill="white" /></g><g opacity="0.15" filter="url(#filter6_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.651 9.7945L22.6339 12.2275C23.2915 10.9972 23.9965 10.0506 25.6601 9.8029L22.651 9.7945Z" fill="white" /></g><g opacity="0.1" filter="url(#filter7_f_6_294)"><path fill-rule="evenodd" clip-rule="evenodd" d="M33.0511 9.80711L33.0341 12.2401C33.4224 10.7197 34.1452 9.85071 36.0603 9.81551L33.0511 9.80711Z" fill="white" /></g><path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M38.098 17.097H11.903L17.0632 21.5296H32.9392L38.098 17.097Z" fill="url(#paint1_linear_6_294)" /><defs><filter id="filter0_f_6_294" x="29.2779" y="8.33814" width="12.1632" height="38.9041" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.472847" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter1_f_6_294" x="11.8961" y="9.22674" width="7.09287" height="7.82687" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.264306" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter2_f_6_294" x="16.8022" y="21.2857" width="9.1196" height="12.0109" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.372642" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter3_f_6_294" x="14.0116" y="33.4059" width="5.03153" height="3.52248" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.173196" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter4_f_6_294" x="13.2802" y="37.5455" width="2.00443" height="3.7007" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.118874" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter5_f_6_294" x="9.58774" y="41.6247" width="5.84539" height="4.60551" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.239638" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter6_f_6_294" x="22.3882" y="9.54884" width="3.51757" height="2.92433" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.122832" result="effect1_foregroundBlur_6_294" /></filter><filter id="filter7_f_6_294" x="32.7884" y="9.56144" width="3.51757" height="2.92433" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.122832" result="effect1_foregroundBlur_6_294" /></filter><linearGradient id="paint0_linear_6_294" x1="9.00493" y1="27.7909" x2="40.9944" y2="27.7909" gradientUnits="userSpaceOnUse"><stop stop-color="#737373" /><stop offset="1" stop-color="#303030" /></linearGradient><linearGradient id="paint1_linear_6_294" x1="38.097" y1="19.31" x2="11.9025" y2="19.31" gradientUnits="userSpaceOnUse"><stop /><stop offset="1" stop-opacity="0" /></linearGradient></defs></g>  `;
  if (pieces.includes("B"))
    svg += `<g id="B" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M31.016 32.267L35.7419 26.3238L25.5519 13.3488H24.8511V13.3384H24.1401L13.9501 26.3134L18.676 32.2565L17.1332 37.1235C17.1021 37.5091 20.2283 39.1571 24.8464 39.1571C29.4642 39.1571 32.5915 37.509 32.5599 37.1235L31.016 32.267Z" fill="url(#paint0_linear_6_305)" stroke="black" stroke-linecap="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M24.8261 7.6979C23.2763 7.6979 22.0193 8.9369 22.0193 10.4653C22.0193 11.9937 23.2764 13.2325 24.8261 13.2325C26.3758 13.2325 27.6313 11.9931 27.6313 10.4653C27.6313 8.9372 26.3758 7.6981 24.8261 7.6979V7.6979Z" fill="url(#paint1_linear_6_305)" stroke="black" stroke-width="0.99998" stroke-linecap="round" stroke-linejoin="round" /><path d="M22.0961 24.66H27.5961M24.8461 21.9101V27.4101" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.15" filter="url(#filter0_f_6_305)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.8383 7.7169C28.3638 9.56943 25.3563 12.7559 23.2615 13.0362C23.7385 13.2374 24.2721 13.3537 24.8383 13.3537C30.5507 11.5554 26.2004 7.58567 24.8383 7.71687V7.7169ZM24.1275 13.3555C27.3223 17.5602 30.1705 21.9989 33.143 26.3416L28.1761 31.6541L29.3019 36.1732L32.4029 37.0546L31.0038 32.2839L35.7289 26.3415L25.5401 13.3667H24.8391V13.3558L24.1275 13.3555Z" fill="black" /></g><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M26.073 35.618C22.9858 35.6302 19.6757 36.1221 17.7042 37.3856C19.8856 38.8871 23.5025 39.2122 26.5892 39.1553C19.4495 37.7113 28.6192 36.1897 31.4333 36.1546C29.9109 35.7872 27.7237 35.6114 26.073 35.6181V35.618Z" fill="black" /><path d="M17.134 37.123C17.134 37.123 19.0586 35.5571 24.8479 35.5571C30.6372 35.5571 32.5608 37.123 32.5608 37.123" stroke="black" stroke-width="0.99998" /><path d="M18.676 32.256C18.676 32.256 20.539 31.2346 24.8512 31.2345C29.1634 31.2344 31.0263 32.256 31.0263 32.256" stroke="black" stroke-width="0.99998" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M18.872 31.579C18.872 31.579 18.8745 31.587 18.872 31.579L14.7012 26.3202L24.4365 13.8892L16.3612 26.2742L18.872 31.579Z" fill="white" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M25 39.156C19.3831 39.1561 17.7042 37.3856 17.7042 37.3856C17.7042 37.3856 19.3829 35.6153 25 35.6152C30.6169 35.6151 32.2958 37.3856 32.2958 37.3856C32.2958 37.3856 30.6171 39.1559 25 39.156Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M22.488 39.156C17.2949 45.4145 10.698 36.2408 3.95496 42.6433L5.92286 46.2961C10.3209 40.6242 24.8379 51.5094 24.8379 39.156H22.488Z" fill="url(#paint2_linear_6_305)" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M27.1879 39.156C32.381 45.4145 38.9779 36.2408 45.7199 42.6433L43.752 46.2961C39.354 40.6242 24.837 51.5094 24.837 39.156H27.1879Z" fill="url(#paint3_linear_6_305)" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M4.67224 42.735L6.07564 45.325L5.72988 42.9915C8.84998 40.6044 11.6875 41.3721 13.7706 41.3931C13.7706 41.3931 7.91858 39.4384 4.67228 42.735H4.67224Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M45.08 42.769L44.5903 43.6576C42.685 41.3331 40.8513 40.9023 39.2715 40.8974C39.2715 40.8974 42.2887 40.1802 45.08 42.7691V42.769Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M23.672 12.366C23.422 12.4323 21.0687 9.9458 24.0896 8.3908C24.0006 8.3817 22.3323 10.5327 23.672 12.366Z" fill="white" /><g opacity="0.7" filter="url(#filter1_f_6_305)"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.1427 35.9463L19.1942 32.673C19.1942 32.673 19.5632 32.4197 20.6487 32.244C20.6487 32.244 19.9026 34.444 21.1566 35.2535C19.0014 35.586 18.619 35.8015 18.1427 35.9462V35.9463Z" fill="white" /></g><defs><filter id="filter0_f_6_305" x="22.4253" y="6.87753" width="14.1397" height="31.0132" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.418085" result="effect1_foregroundBlur_6_305" /></filter><filter id="filter1_f_6_305" x="18.1421" y="32.2434" width="3.01514" height="3.70351" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.000307138" result="effect1_foregroundBlur_6_305" /></filter><linearGradient id="paint0_linear_6_305" x1="13.3742" y1="26.2472" x2="36.316" y2="26.2472" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_305" x1="21.5713" y1="10.4656" x2="28.0773" y2="10.4656" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint2_linear_6_305" x1="3.3756" y1="42.725" x2="25.4214" y2="42.725" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint3_linear_6_305" x1="24.2587" y1="42.725" x2="46.304" y2="42.725" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient></defs></g>  `;
  if (pieces.includes("K"))
    svg += `<g id="K" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1321 18.792C35.5189 13.0511 46.6761 16.1857 45.9831 25.6045C45.3042 31.7749 38.9699 33.9519 38.9699 33.9519C38.9699 33.9519 35.1429 31.7241 25.0299 31.724L25.0161 27.7311L29.1321 18.792Z" fill="url(#paint0_linear_6_321)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M37.942 38.831L39.2464 44.1068C39.2464 44.1068 35.4676 46.3347 24.9994 46.3349C14.5314 46.3347 10.7524 44.1068 10.7524 44.1068L12.0563 38.831L11.0598 33.9525C11.0598 33.9525 14.705 31.7245 25.0008 31.7244C35.2958 31.7243 38.9398 33.9525 38.9398 33.9525L37.942 38.831Z" fill="url(#paint1_linear_6_321)" stroke="black" /><path d="M10.754 44.106C10.754 44.106 14.533 41.8778 25.002 41.8778C35.471 41.8777 39.25 44.106 39.25 44.106" stroke="black" /><path d="M12.058 38.831C12.058 38.831 15.4517 36.6029 25.036 36.6028C34.6197 36.6027 38.013 38.831 38.013 38.831" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M20.9 18.792C14.5132 13.0511 3.35601 16.1857 4.04901 25.6045C4.72784 31.775 11.0622 33.9519 11.0622 33.9519C11.0622 33.9519 14.8892 31.7241 25.0022 31.724L25.016 27.7311L20.9 18.792Z" fill="url(#paint2_linear_6_321)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M21.65 9.9111H28.3827ZM25.0162 6.3286V14.3097Z" fill="#59917A" /><path d="M21.65 9.9111H28.3827M25.0162 6.3286V14.3097" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.15" filter="url(#filter0_f_6_321)"><path fill-rule="evenodd" clip-rule="evenodd" d="M36.557 15.926C35.9954 15.93 35.4113 15.9772 34.8057 16.0716C43.9959 15.8479 48.4006 28.0392 36.2153 32.5698L34.929 37.5321L36.472 43.0186L39.4668 44.1241L37.9607 38.6513L38.9585 33.4402C38.9585 33.4402 45.3022 31.657 45.9709 25.6129C46.4829 20.9855 43.3951 15.8785 36.557 15.9261V15.926Z" fill="black" /></g><path fill-rule="evenodd" clip-rule="evenodd" d="M20.9 18.792L25.0296 27.4454L29.1592 18.792C29.1592 18.792 29.8624 14.0245 25.0296 14.0245C20.1968 14.0245 20.9 18.792 20.9 18.792Z" fill="url(#paint3_linear_6_321)" stroke="black" stroke-linejoin="round" /><g opacity="0.15" filter="url(#filter1_f_6_321)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0281 14.2546C29.8392 15.2254 25.9052 24.7831 25.0442 27.4512C25.0684 27.4763 28.1574 22.0432 29.1099 18.5312C29.2 14.023 25.1988 14.1351 25.0281 14.2544V14.2546Z" fill="black" /></g><g opacity="0.15" filter="url(#filter2_f_6_321)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0179 31.2082L25.017 31.1328C25.0179 31.2082 25.0328 27.7348 25.0328 27.7348C25.0328 27.7348 22.3216 20.8337 20.9354 18.8136C19.5868 16.8483 17.1145 15.8818 14.2964 16.0271C18.3135 17.7936 23.3346 26.0641 25.0182 31.2082H25.0179Z" fill="black" /></g><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M6.31433 29.527C5.11813 27.8797 4.30313 25.6769 4.86863 22.8915C6.30513 15.817 14.3256 16.5952 14.3256 16.5952C2.73063 20.0631 6.45373 29.5572 6.31433 29.5272V29.527Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M23.57 23.025L21.4565 18.6226C21.4565 18.6226 20.7659 14.5027 24.9967 14.5666C20.7837 15.8976 23.57 23.0251 23.57 23.0251V23.025Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M27.026 24.959L29.7781 19.0303C29.7781 19.0303 32.2247 16.8067 35.8945 16.4588C31.947 17.4909 29.5644 21.3335 27.026 24.9591V24.959Z" fill="white" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M25.318 41.924C15.007 41.9241 10.754 44.1067 10.754 44.1067C10.754 44.1067 15.0069 46.2892 25.318 46.2892H25.3393C9.89827 44.2992 32.6541 42.4862 33.6235 42.4785C31.4502 42.1621 28.7064 41.9247 25.3183 41.9248L25.318 41.924Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M25 46.296C15.759 46.2961 11.256 44.0872 11.256 44.0872C11.256 44.0872 15.759 41.8785 25 41.8784C34.241 41.8783 38.744 44.0872 38.744 44.0872C38.744 44.0872 34.241 46.2959 25 46.296V46.296Z" fill="black" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M12.528 39.169C13.3781 38.7193 14.2568 38.5261 15.1214 38.2071C14.5335 39.0481 14.487 40.931 14.7641 42.2694C14.7641 42.2694 13.8721 42.3936 11.5323 43.1737L12.528 39.169Z" fill="white" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M12.464 38.021C12.464 38.021 12.7646 37.7332 14.8802 37.1442C13.2892 35.543 13.48 33.698 13.3055 33.6282C12.739 33.7961 12.1937 34.0171 11.6555 34.2556L12.464 38.021Z" fill="white" /><defs><filter id="filter0_f_6_321" x="34.0173" y="15.1374" width="12.7966" height="29.7751" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.394181" result="effect1_foregroundBlur_6_321" /></filter><filter id="filter1_f_6_321" x="24.6817" y="13.8702" width="4.77609" height="13.9275" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.17318" result="effect1_foregroundBlur_6_321" /></filter><filter id="filter2_f_6_321" x="13.7778" y="15.4942" width="11.7737" height="16.2327" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.259317" result="effect1_foregroundBlur_6_321" /></filter><linearGradient id="paint0_linear_6_321" x1="24.5326" y1="24.9632" x2="46.5284" y2="24.9632" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_321" x1="10.1923" y1="39.0345" x2="39.8336" y2="39.0345" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint2_linear_6_321" x1="3.52785" y1="24.9632" x2="25.5337" y2="24.9632" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint3_linear_6_321" x1="20.3761" y1="20.7398" x2="29.7104" y2="20.7398" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient></defs></g> `;
  if (pieces.includes("N"))
    svg += `<g id="N" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.393 35.883C13.2799 38.29 14.5504 35.1814 15.5712 32.8299C16.9688 28.8774 22.6988 31.0041 24.3039 26.0349C27.1346 37.1199 14.4394 34.4284 15.0401 46.2959H43.4261C45.3388 24.1929 38.4241 8.8749 17.4691 11.0079C15.3856 8.8317 12.4769 7.4498 12.4769 7.4498C11.3475 9.5346 11.4646 12.1663 13.1437 13.1718C13.5828 13.5727 9.61674 15.2502 10.1483 21.0635C10.1483 21.0635 6.95584 26.3808 5.09334 29.8753C3.73684 32.6069 6.16744 36.1398 9.62894 36.4643" fill="url(#paint0_linear_6_339)" /><path d="M10.393 35.883C13.2799 38.29 14.5504 35.1814 15.5712 32.8299C16.9688 28.8774 22.6988 31.0041 24.3039 26.0349C27.1346 37.1199 14.4394 34.4284 15.0401 46.2959H43.4261C45.3388 24.1929 38.4241 8.8749 17.4691 11.0079C15.3856 8.8317 12.4769 7.4498 12.4769 7.4498C11.3475 9.5346 11.4646 12.1663 13.1437 13.1718C13.5828 13.5727 9.61674 15.2502 10.1483 21.0635C10.1483 21.0635 6.95584 26.3808 5.09334 29.8753C3.73684 32.6069 6.16744 36.1398 9.62894 36.4643" stroke="black" stroke-linecap="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M16.859 17.328C16.8413 17.329 16.8237 17.331 16.8061 17.334C13.8635 17.8126 13.4541 20.592 13.4541 20.592C13.3942 20.8881 13.5858 21.1768 13.8828 21.2377C14.1807 21.2985 14.4717 21.1073 14.5328 20.8105C14.5328 20.8105 14.705 18.7874 16.9843 18.4167C17.2843 18.3677 17.4876 18.0856 17.4384 17.7866C17.3924 17.508 17.1417 17.3096 16.859 17.3282L16.859 17.328Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M16.6999 19.572C16.73 19.7159 16.7294 19.8654 16.6983 20.0119C16.6672 20.1585 16.6061 20.2992 16.5185 20.4261C16.4309 20.5529 16.3186 20.6635 16.1879 20.7514C16.0572 20.8393 15.9107 20.9028 15.7568 20.9384C15.6029 20.974 15.4446 20.9808 15.2909 20.9586C15.1372 20.9364 14.9911 20.8855 14.8611 20.8089C14.731 20.7323 14.6194 20.6315 14.5328 20.5121C14.4461 20.3928 14.386 20.2573 14.356 20.1134C14.3259 19.9696 14.3265 19.8201 14.3576 19.6735C14.3888 19.527 14.4499 19.3863 14.5375 19.2594C14.625 19.1325 14.7374 19.0219 14.8681 18.934C14.9988 18.8461 15.1452 18.7826 15.2991 18.747C15.4531 18.7115 15.6114 18.7046 15.7651 18.7268C15.9187 18.7491 16.0648 18.7999 16.1949 18.8765C16.325 18.9531 16.4365 19.054 16.5232 19.1733C16.6098 19.2926 16.6699 19.4281 16.6999 19.572V19.572Z" fill="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M8.41882 29.95C8.27485 29.951 8.1371 30.0088 8.03511 30.11C7.59664 30.5462 7.36609 30.9593 7.25596 31.2824C7.14583 31.6054 7.16196 31.8988 7.16196 31.8988C7.19006 32.1996 7.45704 32.4211 7.75905 32.3943C8.06256 32.3672 8.47388 32.1464 8.44581 31.8441C8.44581 31.8441 8.43211 31.8431 8.48691 31.6822C8.54171 31.5215 8.66993 31.2613 8.99982 30.9331C9.2152 30.7188 9.02762 30.3243 8.81226 30.11C8.70788 30.0064 8.56613 29.9487 8.41877 29.9501L8.41882 29.95Z" fill="black" /><g opacity="0.15" filter="url(#filter0_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.3059 11.9585C39.4041 12.6006 41.6029 26.8904 39.9 46.2957H43.4259C45.1793 26.0348 39.5124 11.4764 22.416 10.8339L22.3059 11.9585Z" fill="black" /></g><path fill-rule="evenodd" clip-rule="evenodd" d="M17.454 12.38C17.454 12.38 18.1063 8.2372 21.3544 7.5321C21.3544 7.5321 23.4332 8.6168 23.0179 13.501" fill="url(#paint1_linear_6_339)" /><path d="M17.454 12.38C17.454 12.38 18.1063 8.2372 21.3544 7.5321C21.3544 7.5321 23.4332 8.6168 23.0179 13.501" stroke="black" stroke-linecap="round" /><path d="M12.206 33.765C11.8995 34.2912 10.7541 35.5116 9.63049 36.4662" stroke="black" stroke-linecap="round" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M5.42737 30.42L9.62157 23.096L10.7936 21.2041C10.7936 21.2041 9.99659 16.7896 13.5127 13.8233C13.5122 13.8243 14.0674 13.2091 13.5157 12.7173C12.9632 12.2252 11.5797 10.5886 12.763 8.3812C12.686 8.35919 13.0371 13.187 17.1163 13.2451C13.1972 14.4944 11.0053 18.2343 11.9653 21.8273C11.2297 23 10.5077 23.9071 9.59097 25.0352C8.77078 26.0445 7.79467 27.2306 6.51337 28.9421C6.17384 29.3957 5.81287 29.8861 5.42767 30.4199L5.42737 30.42Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M15.757 45.676C15.0133 36.2414 25.841 36.8812 25.1953 28.066C26.2988 39.037 17.3118 37.1951 15.757 45.676Z" fill="white" /><g filter="url(#filter1_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.75669 30.4951C6.74189 31.0654 8.34358 28.6155 9.81721 30.058C9.21913 28.6341 7.59925 28.1638 6.75669 30.4951Z" fill="white" /></g><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M18.027 12.578C18.027 12.578 18.6071 8.8785 21.2757 8.1187C19.7222 10.09 19.5307 13.2725 18.027 12.578Z" fill="white" /><g opacity="0.15" filter="url(#filter2_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.6958 25.1264C25.1003 23.9466 25.0214 22.0868 24.665 21.5284C21.7066 30.1656 16.4207 26.9988 15.5645 32.8307C17.2038 29.1378 23.3771 30.4204 24.6958 25.1268V25.1264Z" fill="black" /></g><g opacity="0.8" filter="url(#filter3_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.8562 17.3272C13.6395 17.9403 13.4513 20.5912 13.4513 20.5912C13.4513 20.5912 12.9526 20.8012 12.9608 20.2645C12.7302 19.5792 14.1759 16.8035 16.8562 17.3272V17.3272Z" fill="white" /></g><g filter="url(#filter4_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.0623 21.7525C17.065 20.9907 16.2622 27.133 16.2622 27.133C17.1112 25.2301 19.5475 22.7252 22.0623 21.7525Z" fill="white" /></g><path d="M24.304 26.035C24.304 26.035 24.7026 25.1261 25.0477 22.5481" stroke="black" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.15" filter="url(#filter5_f_6_339)"><path fill-rule="evenodd" clip-rule="evenodd" d="M23.9871 32.169C24.3513 32.143 29.3575 25.9538 25.0481 22.5482L24.5379 27.105C24.6453 28.7868 24.9748 30.4639 23.9871 32.1691L23.9871 32.169Z" fill="black" /></g><defs><filter id="filter0_f_6_339" x="21.1682" y="9.69619" width="23.6999" height="37.7372" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.568857" result="effect1_foregroundBlur_6_339" /></filter><filter id="filter1_f_6_339" x="6.15969" y="28.2714" width="4.25448" height="2.9084" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.298452" result="effect1_foregroundBlur_6_339" /></filter><filter id="filter2_f_6_339" x="14.6327" y="20.5967" width="11.2662" height="13.1657" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.465863" result="effect1_foregroundBlur_6_339" /></filter><filter id="filter3_f_6_339" x="12.7911" y="17.1161" width="4.21087" height="3.66133" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.0728904" result="effect1_foregroundBlur_6_339" /></filter><filter id="filter4_f_6_339" x="14.5612" y="19.9861" width="9.20212" height="8.84789" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.850486" result="effect1_foregroundBlur_6_339" /></filter><filter id="filter5_f_6_339" x="23.4281" y="21.9892" width="3.91913" height="10.7389" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.279496" result="effect1_foregroundBlur_6_339" /></filter><linearGradient id="paint0_linear_6_339" x1="4.22684" y1="26.7998" x2="44.2248" y2="26.7998" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_339" x1="2.33454" y1="9.76174" x2="45.5437" y2="9.76174" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient></defs></g> `;
  if (pieces.includes("P"))
    svg += `<g id="P" fill="none"><path d="M25 24.9601C28.9549 24.9601 32.1609 21.9004 32.1609 18.126C32.1609 14.3516 28.9549 11.2919 25 11.2919C21.0452 11.2919 17.8391 14.3516 17.8391 18.126C17.8391 21.9004 21.0452 24.9601 25 24.9601Z" fill="url(#paint0_linear_6_356)" stroke="black" stroke-linejoin="round" /><path fill-rule="evenodd" clip-rule="evenodd" d="M24.9999 24.598C19.7718 24.6425 17.015 24.5703 16.6058 29.1059H33.3938C32.9846 24.5703 30.2284 24.6425 25.0002 24.598H24.9999Z" fill="url(#paint1_linear_6_356)" stroke="black" /><path fill-rule="evenodd" clip-rule="evenodd" d="M20.484 29.106C20.9797 35.8935 11.1807 37.1018 11.7781 46.296H38.2221C38.8194 37.1015 29.0204 35.893 29.5161 29.106H25.0003H20.484Z" fill="url(#paint2_linear_6_356)" stroke="black" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M19.8839 21.629C19.3561 21.8544 15.2989 14.0007 24.7514 11.8566C25.4684 11.7382 26.0027 12.4977 24.7593 12.8961C24.7593 12.8961 17.0197 16.2429 19.8838 21.629H19.8839Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M12.504 45.701C12.1798 44.4614 12.3004 41.7278 16.0167 37.6929C15.647 40.1301 12.9524 43.086 15.1165 45.7171L12.504 45.701Z" fill="white" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M17.282 28.557C17.282 28.557 17.2564 25.6518 20.3881 25.4153C19.3095 26.6268 18.9258 27.321 19.4552 28.5892L17.282 28.557Z" fill="white" /><g opacity="0.1" filter="url(#filter0_f_6_356)"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.9813 29.1111C22.2046 34.9807 40.3579 38.1665 38.2185 46.3016C39.4805 38.6426 29.114 36.493 29.5125 29.1111H21.9813Z" fill="black" /></g><g opacity="0.15" filter="url(#filter1_f_6_356)"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.0087 11.2899C29.8888 11.934 31.4784 21.4989 26.8922 24.3698C26.8922 24.3698 30.2355 24.8673 30.7831 26.9832C30.9492 27.6252 31.2422 29.1035 31.2422 29.1035L33.4023 29.1042C33.4023 29.1042 33.2097 27.6065 32.9422 26.9993C32.0704 25.0211 28.3459 24.3055 28.3459 24.3055C30.1812 23.1592 32.1696 20.1709 32.1696 18.1242C32.5504 13.6997 26.766 10.7865 25.0088 11.29L25.0087 11.2899Z" fill="black" /></g><defs><filter id="filter0_f_6_356" x="21.3093" y="28.4391" width="17.7565" height="18.5346" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.336027" result="effect1_foregroundBlur_6_356" /></filter><filter id="filter1_f_6_356" x="24.4834" y="10.7083" width="9.44425" height="18.9212" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.262642" result="effect1_foregroundBlur_6_356" /></filter><linearGradient id="paint0_linear_6_356" x1="17.3399" y1="18.1265" x2="32.6484" y2="18.1265" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_356" x1="16.0642" y1="26.8523" x2="33.924" y2="26.8523" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint2_linear_6_356" x1="11.2558" y1="37.7018" x2="38.7325" y2="37.7018" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient></defs></g> `;
  if (pieces.includes("Q"))
    svg += `<g id="Q" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M37.159 38.874L40.3298 34.0652L44.568 14.2392L34.9149 29.0372L35.0589 11.5982L28.156 28.0112L24.989 10.0822L21.8219 28.0092L14.9196 11.5962L15.0637 29.0352L5.4104 14.2372L9.6489 34.0632L13.0086 38.872L11.5999 44.2571C11.5999 44.2571 15.996 46.2959 24.9999 46.296C34.0039 46.2961 38.3889 44.2581 38.3889 44.2581L37.159 38.874Z" fill="url(#paint0_linear_6_365)" stroke="black" stroke-width="1.0011" stroke-linecap="round" /><path d="M9.74707 34.064C11.0943 34.2442 11.3918 33.7095 11.8028 32.1576C11.8028 32.1576 14.2908 33.5013 15.5654 33.2198C16.9296 32.9185 18.0389 31.0481 18.0389 31.0481C18.0389 31.0481 20.1519 32.6068 21.4197 32.502C22.8939 32.3802 24.9228 30.5215 24.9228 30.5215C24.9228 30.5215 26.9517 32.3802 28.4259 32.502C29.6938 32.6068 31.8069 31.0481 31.8069 31.0481C31.8069 31.0481 32.9162 32.9185 34.2805 33.2198C35.5552 33.5013 38.043 32.1576 38.043 32.1576C38.454 33.7095 38.8825 34.2458 40.2298 34.0655" stroke="black" stroke-width="1.0011" stroke-linecap="round" /><path d="M5.41005 17.0371C7.00852 17.0371 8.30435 15.7839 8.30435 14.238C8.30435 12.6921 7.00852 11.4389 5.41005 11.4389C3.81157 11.4389 2.51575 12.6921 2.51575 14.238C2.51575 15.7839 3.81157 17.0371 5.41005 17.0371Z" fill="url(#paint1_linear_6_365)" stroke="black" stroke-width="1.0011" stroke-linecap="round" stroke-linejoin="round" /><g opacity="0.15" filter="url(#filter0_f_6_365)"><path fill-rule="evenodd" clip-rule="evenodd" d="M44.0123 15.722C42.8213 20.3414 39.3118 28.9491 37.9644 33.5338L34.2268 38.2441L35.3067 43.1216L38.3852 44.2559L37.159 38.8699L40.12 34.2979L44.0123 15.722Z" fill="black" /></g><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M24.4961 41.69C19.6607 41.69 14.8252 42.5465 11.6021 44.2595C14.8286 45.974 19.6701 46.0065 24.5101 46.0048C12.5931 44.1277 26.4715 42.3125 31.2494 42.2786C29.1149 41.8876 26.8068 41.69 24.4967 41.69L24.4961 41.69Z" fill="black" /><path d="M11.601 44.26C11.601 44.26 15.9885 42.1237 24.993 42.1236C33.997 42.1235 38.385 44.26 38.385 44.26" stroke="black" stroke-width="1.0011" /><path d="M12.8571 38.874C12.8571 38.874 16.5228 36.8335 25.0081 36.8334C33.4931 36.8333 37.1591 38.874 37.1591 38.874" stroke="black" stroke-width="1.0011" /><path d="M14.9201 13.8791C16.5185 13.8791 17.8144 12.6259 17.8144 11.08C17.8144 9.5341 16.5185 8.2809 14.9201 8.2809C13.3216 8.2809 12.0258 9.5341 12.0258 11.08C12.0258 12.6259 13.3216 13.8791 14.9201 13.8791Z" fill="url(#paint2_linear_6_365)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M24.989 12.8811C26.5875 12.8811 27.8833 11.6279 27.8833 10.082C27.8833 8.53611 26.5875 7.28291 24.989 7.28291C23.3905 7.28291 22.0947 8.53611 22.0947 10.082C22.0947 11.6279 23.3905 12.8811 24.989 12.8811Z" fill="url(#paint3_linear_6_365)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M35.0591 13.8811C36.6576 13.8811 37.9534 12.6279 37.9534 11.082C37.9534 9.53611 36.6576 8.28291 35.0591 8.28291C33.4606 8.28291 32.1648 9.53611 32.1648 11.082C32.1648 12.6279 33.4606 13.8811 35.0591 13.8811Z" fill="url(#paint4_linear_6_365)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path d="M44.568 17.0381C46.1665 17.0381 47.4623 15.7849 47.4623 14.239C47.4623 12.6931 46.1665 11.4399 44.568 11.4399C42.9695 11.4399 41.6737 12.6931 41.6737 14.239C41.6737 15.7849 42.9695 17.0381 44.568 17.0381Z" fill="url(#paint5_linear_6_365)" stroke="black" stroke-width="1.0022" stroke-linecap="round" stroke-linejoin="round" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M6.65698 17.385L10.119 33.514C10.119 33.514 10.9129 33.5706 11.3923 31.2195L6.65698 17.385Z" fill="white" /><path opacity="0.9" fill-rule="evenodd" clip-rule="evenodd" d="M15.522 14.499L17.8629 29.668C17.2368 30.7555 16.3907 31.6681 15.6994 31.838L15.522 14.499Z" fill="white" /><path opacity="0.9" fill-rule="evenodd" clip-rule="evenodd" d="M21.986 31.027L25.013 13.415L24.8741 29.172C23.8077 30.0855 22.7249 31.0301 21.986 31.0266L21.986 31.027Z" fill="white" /><path opacity="0.9" fill-rule="evenodd" clip-rule="evenodd" d="M34.459 14.605L27.6787 30.787C27.6948 30.6952 28.1458 32.181 31.5094 29.5431L34.459 14.605Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M33.921 31.807L43.14 17.481L37.5416 30.827C37.5416 30.827 34.3887 32.5613 33.921 31.8069V31.807Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M4.18435 16.16C4.18435 16.16 1.16685 13.4685 5.11851 11.9894C5.20637 12.0034 3.28551 14.1454 4.18435 16.16Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M13.831 13.031C13.831 13.031 10.8135 10.3395 14.7651 8.8604C14.8545 8.86042 12.969 10.9146 13.831 13.031Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M23.849 12.006C23.849 12.006 20.8315 9.3145 24.7832 7.8354C24.8416 7.83625 22.8559 9.926 23.849 12.006Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M33.935 12.992C33.935 12.992 30.9175 10.3005 34.8691 8.8214C34.9133 8.81847 32.9503 10.9145 33.935 12.992Z" fill="white" /><path fill-rule="evenodd" clip-rule="evenodd" d="M43.4309 16.15C43.4309 16.15 40.4134 13.4585 44.3651 11.9794C44.4113 11.9975 42.4826 14.1697 43.4309 16.15Z" fill="white" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M24.993 46.396C15.989 46.3961 11.601 44.2596 11.601 44.2596C11.601 44.2596 15.9885 42.1233 24.993 42.1232C33.997 42.1231 38.385 44.2596 38.385 44.2596C38.385 44.2596 33.9975 46.3959 24.993 46.396Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M6.77136 12.412C6.85186 12.4382 9.08556 14.1627 6.62357 16.2759C6.54966 16.1517 7.78577 14.2748 6.77136 12.412V12.412Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M16.3361 9.2456C16.4166 9.27183 18.6503 10.9963 16.1883 13.1095C16.1144 12.9853 17.3505 11.1084 16.3361 9.2456Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M26.4251 8.2762C26.5056 8.30244 28.7393 10.0269 26.2773 12.1401C26.2033 12.0159 27.4395 10.139 26.4251 8.2762Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M36.515 9.2684C36.5955 9.29464 38.8292 11.0191 36.3672 13.1323C36.2933 13.0082 37.5294 11.1312 36.515 9.2684Z" fill="black" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M46.059 12.565C46.1395 12.5912 48.3732 14.3157 45.9112 16.4289C45.8373 16.3048 47.0734 14.4278 46.059 12.565V12.565Z" fill="black" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M13.514 39.223C14.3623 38.7733 15.2139 38.5634 16.085 38.3446C15.4984 39.1856 15.4687 40.985 15.7452 42.3234C15.7452 42.3234 14.8552 42.4476 12.5206 43.2277L13.514 39.223Z" fill="white" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M13.146 38.084C13.2559 38.068 13.4761 37.7947 15.7375 37.1326C13.7229 35.5476 12.1866 33.0579 12.1866 33.0579C11.8584 33.9725 11.4138 34.5721 10.7717 34.6375L13.146 38.084Z" fill="white" /><defs><filter id="filter0_f_6_365" x="33.4604" y="14.9556" width="11.3183" height="30.0667" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.383194" result="effect1_foregroundBlur_6_365" /></filter><linearGradient id="paint0_linear_6_365" x1="5.44096" y1="28.391" x2="44.5373" y2="28.391" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_365" x1="2.0193" y1="14.2362" x2="8.79948" y2="14.2362" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint2_linear_6_365" x1="11.5293" y1="11.0787" x2="18.3095" y2="11.0787" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint3_linear_6_365" x1="21.5986" y1="10.0816" x2="28.3793" y2="10.0816" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint4_linear_6_365" x1="31.6688" y1="11.0787" x2="38.4495" y2="11.0787" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint5_linear_6_365" x1="41.1778" y1="14.2362" x2="47.959" y2="14.2362" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient></defs></g> `;
  if (pieces.includes("R"))
    svg += `<g id="R" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.9729 41.57H37.0939ZM12.9669 37.199H37.0329ZM16.9719 33.1474H33.0299ZM17.0619 21.5294H32.9409ZM11.9029 17.0968H38.0989ZM11.9029 9.2861V17.0971L17.0612 21.5297L16.9717 33.1477L12.9678 37.1992V41.5703H9.50537V46.2959H40.4954V41.5703H37.033V37.1992L33.029 33.1477L32.9396 21.5297L38.0979 17.0971V9.2861H32.505V12.6343H27.8917V9.2861H22.1091V12.6343H17.4958V9.2861H11.9029Z" fill="url(#paint0_linear_6_395)" /><path d="M12.9729 41.57H37.0939M12.9669 37.199H37.0329M16.9719 33.1474H33.0299M17.0619 21.5294H32.9409M11.9029 17.0968H38.0989M11.9029 9.2861V17.0971L17.0612 21.5297L16.9717 33.1477L12.9678 37.1992V41.5703H9.50537V46.2959H40.4954V41.5703H37.033V37.1992L33.029 33.1477L32.9396 21.5297L38.0979 17.0971V9.2861H32.505V12.6343H27.8917V9.2861H22.1091V12.6343H17.4958V9.2861H11.9029Z" stroke="black" stroke-linecap="round" /><g opacity="0.15" filter="url(#filter0_f_6_395)"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.3992 9.28414V17.0955L30.2236 21.5304L30.3151 33.1481L34.8655 37.1996L34.866 37.2002L34.8655 41.571H37.7814V46.2965H40.4954V41.571H37.0329L37.0334 37.2002L37.0328 37.1996L33.029 33.1481L32.9376 21.5274L38.0956 17.0952V9.28384L35.3992 9.28414Z" fill="black" /></g><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M12.4659 16.525L12.4247 9.8501L15.7527 9.75536L13.7558 10.4663V15.8222L18.4603 16.4886L12.4659 16.525Z" fill="white" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M17.596 22.031H25.1765L18.709 23.0305V31.6289L17.5475 32.5514L17.596 22.031Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M14.358 36.582L17.2177 33.7523H18.6967L16.2961 36.582H14.358Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M13.5179 37.794L13.5226 41.0084H15.0468L15.0436 37.7832L13.5179 37.794Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M10.067 42.104H11.0816V44.7631L14.9539 45.751H10.067V42.104Z" fill="white" /><path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M22.651 9.7945L22.6339 12.2275C23.2915 10.9972 23.9965 10.0506 25.6601 9.8029L22.651 9.7945Z" fill="white" /><path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M33.0511 9.80711L33.0341 12.2401C33.4224 10.7197 34.1452 9.85071 36.0603 9.81551L33.0511 9.80711Z" fill="white" /><path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd" d="M38.098 17.097H11.903L17.0632 21.5296H32.9392L38.098 17.097Z" fill="url(#paint1_linear_6_395)" /><defs><filter id="filter0_f_6_395" x="29.2779" y="8.33814" width="12.1632" height="38.9041" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix" /><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" /><feGaussianBlur stdDeviation="0.472847" result="effect1_foregroundBlur_6_395" /></filter><linearGradient id="paint0_linear_6_395" x1="9.00493" y1="27.7909" x2="40.9944" y2="27.7909" gradientUnits="userSpaceOnUse"><stop stop-color="#ECE9DF" /><stop offset="1" stop-color="#F4E0C8" /></linearGradient><linearGradient id="paint1_linear_6_395" x1="38.097" y1="19.31" x2="11.9025" y2="19.31" gradientUnits="userSpaceOnUse"><stop /><stop offset="1" stop-opacity="0" /></linearGradient></defs></g>`;

  svg +=
    '<marker id="arr" markerWidth="4" markerHeight="4" refX="1" refY="2" orient="auto"><path d="M3 2L3.96838e-09 4L1.78814e-07 -1.31134e-07L3 2Z" fill="#F00" /></marker></defs><g id="t2"><g id="t1"><rect x="0" y="0" width="50" height="50" fill="#f1f6b2" /><rect x="50" y="0" width="50" height="50" fill="#59935d" /><rect x="0" y="50" width="50" height="50" fill="#59935d" /><rect x="50" y="50" width="50" height="50" fill="#f1f6b2" /></g><use x="100" xlink:href="#t1" /><use y="100" xlink:href="#t1" /><use x="100" y="100" xlink:href="#t1" /></g><use x="200" xlink:href="#t2" /><use y="200" xlink:href="#t2" /><use x="200" y="200" xlink:href="#t2" />';

  // TODO: refactor?
  if (flip ^ (side === "w")) {
    svg += '<text class="l" x="400" y="0" dx="-2" dy="1em" text-anchor="end">1</text>';
    svg += '<text x="400" y="50" dx="-2" dy="1em" text-anchor="end">2</text>';
    svg += '<text class="l" x="400" y="100" dx="-2" dy="1em" text-anchor="end">3</text>';
    svg += '<text x="400" y="150" dx="-2" dy="1em" text-anchor="end">4</text>';
    svg += '<text class="l" x="400" y="200" dx="-2" dy="1em" text-anchor="end">5</text>';
    svg += '<text x="400" y="250" dx="-2" dy="1em" text-anchor="end">6</text>';
    svg += '<text class="l" x="400" y="300" dx="-2" dy="1em" text-anchor="end">7</text>';
    svg += '<text x="400" y="350" dx="-2" dy="1em" text-anchor="end">8</text>';
    svg += '<text class="l" x="0" y="400" dx="2" dy="-2">h</text>';
    svg += '<text x="50" y="400" dx="2" dy="-2">g</text>';
    svg += '<text class="l" x="100" y="400" dx="2" dy="-2">f</text>';
    svg += '<text x="150" y="400" dx="2" dy="-2">e</text>';
    svg += '<text class="l" x="200" y="400" dx="2" dy="-2">d</text>';
    svg += '<text x="250" y="400" dx="2" dy="-2">c</text>';
    svg += '<text class="l" x="300" y="400" dx="2" dy="-2">b</text>';
    svg += '<text x="350" y="400" dx="2" dy="-2">a</text>';
  } else {
    svg += '<text x="0" y="0" dx="2" dy="1em">8</text>';
    svg += '<text class="l" x="0" y="50" dx="2" dy="1em">7</text>';
    svg += '<text x="0" y="100" dx="2" dy="1em">6</text>';
    svg += '<text class="l" x="0" y="150" dx="2" dy="1em">5</text>';
    svg += '<text x="0" y="200" dx="2" dy="1em">4</text>';
    svg += '<text class="l" x="0" y="250" dx="2" dy="1em">3</text>';
    svg += '<text x="0" y="300" dx="2" dy="1em">2</text>';
    svg += '<text class="l" x="0" y="350" dx="2" dy="1em">1</text>';
    svg += '<text class="l" x="50" y="400" dx="-2" dy="-2" text-anchor="end">a</text>';
    svg += '<text x="100" y="400" dx="-2" dy="-2" text-anchor="end">b</text>';
    svg += '<text class="l" x="150" y="400" dx="-2" dy="-2" text-anchor="end">c</text>';
    svg += '<text x="200" y="400" dx="-2" dy="-2" text-anchor="end">d</text>';
    svg += '<text class="l" x="250" y="400" dx="-2" dy="-2" text-anchor="end">e</text>';
    svg += '<text x="300" y="400" dx="-2" dy="-2" text-anchor="end">f</text>';
    svg += '<text class="l" x="350" y="400" dx="-2" dy="-2" text-anchor="end">g</text>';
    svg += '<text x="400" y="400" dx="-2" dy="-2" text-anchor="end">h</text>';
  }

  if (has_mate) {
    check_squares_id.forEach((sq) => {
      const x = (c(sq) % 8) * 50;
      const y = ~~(c(sq) / 8) * 50;
      svg += `<rect x="${x}" y="${y}" width="50" height="50" fill="#f00" opacity="0.5" />`;
    });
  }

  for (let i = 0; i < 64; i++) {
    const sq = _(i);
    if (parsed_fen[sq]) {
      const x = (c(i) % 8) * 50;
      const y = ~~(c(i) / 8) * 50;
      svg += `<use x="${x}" y="${y}" xlink:href="#${parsed_fen[sq]}" />`;
    }
  }

  if (has_mate) {
    check_squares_id.forEach((sq, i) => {
      const ax = (c(attacker_id[i]) % 8) * 50 + 25;
      const ay = ~~(c(attacker_id[i]) / 8) * 50 + 25;
      const sx = (c(sq) % 8) * 50 + 25;
      const sy = ~~(c(sq) / 8) * 50 + 25;
      svg += `<line x1="${ax}" y1="${ay}" x2="${sx}" y2="${sy}" stroke="#f00" stroke-width="4" marker-end="url(#arr)" opacity="0.5" />`;
    });
  }

  svg += "</svg>";

  if (og) {
    sharp(Buffer.from(svg))
      .png()
      .flatten({ background: "#ffd" })
      .toBuffer()
      .then((og_img) => {
        res.header("Content-Type", "image/png");
        return res.end(og_img);
      });
  } else {
    res.header("Content-Type", "image/svg+xml");
    return res.send(svg);
  }
});

const port = process.env.PORT ?? 3000;
const listener = app.listen(port, () =>
  console.log(
    `Server is running on port ${listener.address().address}:${listener.address().port}`
  )
);
